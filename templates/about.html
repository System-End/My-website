{% extends "base.html" %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="page-container animate-fade-in">
    <div class="fox-card header-card">
        <h1 class="text-glow">About Me</h1>
        <p class="text-gradient">{{ name }} â€¢ {{ pronouns }} â€¢ {{ role }}</p>
    </div>

    <div class="content-grid">
        <div class="fox-card">
            <div class="card-header">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon-accent">
                    <polyline points="16 18 22 12 16 6"></polyline>
                    <polyline points="8 6 2 12 8 18"></polyline>
                </svg>
                <h2>Tech Interests</h2>
            </div>
            <ul class="interest-list">
                <li>Programming & Development</li>
                <li>Robotics & Hardware</li>
                <li>Cybersecurity</li>
                <li>Rust Development ðŸ¦€</li>
            </ul>
        </div>

        <div class="fox-card">
            <div class="card-header">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon-accent">
                    <line x1="6" y1="11" x2="10" y2="11"></line>
                    <line x1="8" y1="9" x2="8" y2="13"></line>
                    <line x1="15" y1="12" x2="15.01" y2="12"></line>
                    <line x1="18" y1="10" x2="18.01" y2="10"></line>
                    <path d="M17.32 5H6.68a4 4 0 00-3.978 3.59c-.006.052-.01.101-.017.152C2.604 9.416 2 14.456 2 16a3 3 0 003 3c1 0 1.5-.5 2-1l1.414-1.414A2 2 0 019.828 16h4.344a2 2 0 011.414.586L17 18c.5.5 1 1 2 1a3 3 0 003-3c0-1.545-.604-6.584-.685-7.258-.007-.05-.011-.1-.017-.151A4 4 0 0017.32 5z"></path>
                </svg>
                <h2>Streaming</h2>
            </div>
            <p>Find me on <a href="https://twitch.tv/EndofTimee" class="text-accent-neon" target="_blank" rel="noopener noreferrer">Twitch</a> playing FiveM and other games!</p>
        </div>

        <div class="fox-card">
            <div class="card-header">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon-accent">
                    <path d="M9 18V5l12-2v13"></path>
                    <circle cx="6" cy="18" r="3"></circle>
                    <circle cx="18" cy="16" r="3"></circle>
                </svg>
                <h2>Music</h2>
            </div>
            <div id="music-display" class="music-container">
                <div class="music-loading">
                    <div class="loading-spinner-small"></div>
                    <span>Loading music...</span>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    async function loadLastFm() {
        const container = document.getElementById('music-display');
        
        try {
            const response = await fetch('/api/lastfm');
            const data = await response.json();
            
            if (data.error) {
                container.innerHTML = `
                    <p class="music-fallback">Check out my <a href="https://www.last.fm/user/EndofTimee" class="text-accent-neon" target="_blank" rel="noopener noreferrer">Last.fm profile</a> for what I'm listening to!</p>
                    <div class="spotify-embed">
                        <iframe 
                            title="Spotify Playlist"
                            src="https://open.spotify.com/embed/playlist/58ggvvTcs95yhcSeSxLGks?utm_source=generator"
                            width="100%"
                            height="152"
                            frameBorder="0"
                            allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
                            loading="lazy"
                            style="border-radius: 12px;">
                        </iframe>
                    </div>
                `;
                return;
            }
            
            if (!data.current_track || !data.current_track.is_playing) {
                container.innerHTML = `
                    <p class="music-fallback">Not currently playing anything. Check out my playlist!</p>
                    <div class="spotify-embed">
                        <iframe 
                            title="Spotify Playlist"
                            src="https://open.spotify.com/embed/playlist/58ggvvTcs95yhcSeSxLGks?utm_source=generator"
                            width="100%"
                            height="152"
                            frameBorder="0"
                            allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
                            loading="lazy"
                            style="border-radius: 12px;">
                        </iframe>
                    </div>
                `;
                return;
            }
            
            const track = data.current_track;
            container.innerHTML = `
                <div class="now-playing">
                    <div class="now-playing-indicator">
                        <span class="pulse-dot"></span>
                        <span class="now-playing-text">Now Playing</span>
                    </div>
                    <div class="track-info">
                        <img src="${escapeHtml(track.image) || '/public/placeholder-album.svg'}" 
                             alt="${escapeHtml(track.name)} album art" 
                             class="album-art"
                             onerror="this.src='/public/placeholder-album.svg'">
                        <div class="track-details">
                            <span class="track-name">${escapeHtml(track.name)}</span>
                            <span class="track-artist">${escapeHtml(track.artist)}</span>
                        </div>
                    </div>
                </div>
            `;
        } catch (error) {
            console.error('Failed to load Last.fm data:', error);
            container.innerHTML = `
                <p class="music-fallback">Check out my <a href="https://www.last.fm/user/EndofTimee" class="text-accent-neon" target="_blank" rel="noopener noreferrer">Last.fm profile</a> for what I'm listening to!</p>
            `;
        }
    }
    
    function escapeHtml(unsafe) {
        if (!unsafe) return '';
        return unsafe
            .replace(/&/g, "&amp;")
            .replace(/</g, "&lt;")
            .replace(/>/g, "&gt;")
            .replace(/"/g, "&quot;")
            .replace(/'/g, "&#039;");
    }
    
    // Load on page load and refresh every 30 seconds
    document.addEventListener('DOMContentLoaded', loadLastFm);
    setInterval(loadLastFm, 30000);
</script>
{% endblock %}
